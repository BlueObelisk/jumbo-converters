<template id="bondOrder.valence"
  repeat="*"
  name="BOND ORDER AND VALENCE ANALYSIS"
  pattern="\s+-*\s*$\s+BOND ORDER AND VALENCE ANALYSIS.+$\s*-+\s*"      offset="0"
  endPattern="\s+$\s*-+\s*"   endOffset="0" >

  <comment class="example.input" id="bondOrder.ch4">
          -------------------------------
          BOND ORDER AND VALENCE ANALYSIS     BOND ORDER THRESHOLD=0.050
          -------------------------------

                   BOND                       BOND                       BOND
  ATOM PAIR DIST  ORDER      ATOM PAIR DIST  ORDER      ATOM PAIR DIST  ORDER
    1   2  1.093  0.966        1   3  1.093  0.966        1   4  1.093  0.966
    1   5  1.093  0.966

                       TOTAL       BONDED        FREE
      ATOM            VALENCE     VALENCE     VALENCE
    1 C                 3.863       3.863       0.000
    2 H                 0.939       0.939       0.000
    3 H                 0.939       0.939       0.000
    4 H                 0.939       0.939       0.000
    5 H                 0.939       0.939       0.000

  </comment>
  <comment class="example.input" id="bondOrder.ch2o2">
          -------------------------------
          BOND ORDER AND VALENCE ANALYSIS     BOND ORDER THRESHOLD=0.050
          -------------------------------

                   BOND                       BOND                       BOND
  ATOM PAIR DIST  ORDER      ATOM PAIR DIST  ORDER      ATOM PAIR DIST  ORDER
    1   2  1.208  1.948        1   3  1.342  0.988        1   4  1.080  0.877
    2   3  2.210  0.071        3   5  0.967  0.777

                       TOTAL       BONDED        FREE
      ATOM            VALENCE     VALENCE     VALENCE
    1 C                 3.833       3.833       0.000
    2 O                 2.079       2.079       0.000
    3 O                 1.851       1.851       0.000
    4 H                 0.927       0.927       0.000
    5 H                 0.825       0.825       0.000

  </comment>
  <comment  id="bondOrder.c6h6">
          -------------------------------
          BOND ORDER AND VALENCE ANALYSIS     BOND ORDER THRESHOLD=0.050
          -------------------------------

                   BOND                       BOND                       BOND
  ATOM PAIR DIST  ORDER      ATOM PAIR DIST  ORDER      ATOM PAIR DIST  ORDER
    1   2  1.382  1.453        1   4  2.765  0.103        1   6  1.382  1.453
    1   7  1.080  0.934        2   3  1.382  1.453        2   5  2.765  0.103
    2   8  1.080  0.934        3   4  1.382  1.453        3   6  2.765  0.103
    3   9  1.080  0.934        4   5  1.382  1.453        4  10  1.080  0.934
    5   6  1.382  1.453        5  11  1.080  0.934        6  12  1.080  0.934

                       TOTAL       BONDED        FREE
      ATOM            VALENCE     VALENCE     VALENCE
    1 C                 3.912       3.912       0.000
    2 C                 3.912       3.912       0.000
    3 C                 3.912       3.912       0.000
    4 C                 3.912       3.912       0.000
    5 C                 3.912       3.912       0.000
    6 C                 3.912       3.912       0.000
    7 H                 0.942       0.942       0.000
    8 H                 0.942       0.942       0.000
    9 H                 0.942       0.942       0.000
   10 H                 0.942       0.942       0.000
   11 H                 0.942       0.942       0.000
   12 H                 0.942       0.942       0.000

  </comment>

  <record />
  <record id="bo.threshold">\s+.*={F,g:bondOrderThreshold}\s*</record>
  <record repeat="2" />

  <templateList xmlns:xi="http://www.w3.org/2001/XInclude">
    <xi:include href="bondOrders.valence.bo.xml" />
    <xi:include href="bondOrders.valence.val.xml" />
  </templateList>

  <transform process="createWrapperProperty" xpath=".//*[@dictRef='g:bondOrderThreshold']"/>

  <transform process="move"
                 to="."
                 xpath=".//*[@dictRef='g:valences' or @dictRef='g:bondorders' or @dictRef='g:bondOrderThreshold']" />
 
  <transform process="delete" xpath=".//cml:module[count(*)=0]" />
  <transform process="delete" xpath=".//cml:list[count(*)=0]" />
  <transform process="delete" xpath=".//cml:list[count(*)=0]" />


  <comment class="example.output" id="bondOrder.ch4">
    <module cmlx:templateRef="bondOrder.valence" xmlns="http://www.xml-cml.org/schema" xmlns:cmlx="http://www.xml-cml.org/schema/cmlx">
      <property dictRef="g:bondOrderThreshold">
        <scalar dataType="xsd:double">0.05</scalar>
      </property>
      <property dictRef="g:bondorders">
        <list>
            <array dataType="xsd:integer" dictRef="g:atomId1"  size="4">1 1 1 1</array>
            <array dataType="xsd:integer" dictRef="g:atomId2"  size="4">2 3 4 5</array>
            <array dataType="xsd:double" dictRef="g:distance"  size="4">1.093 1.093 1.093 1.093</array>
            <array dataType="xsd:double" dictRef="g:bondOrder" size="4">0.966 0.966 0.966 0.966</array>
        </list>
      </property>
      <property dictRef="g:valences">
        <list>
          <array dataType="xsd:integer" dictRef="g:atomId"       size="5">1 2 3 4 5</array>
          <array dataType="xsd:string" dictRef="g:atomLabel"     size="5">C H H H H</array>
          <array dataType="xsd:double" dictRef="g:totalValence"  size="5">3.863 0.939 0.939 0.939 0.939</array>
          <array dataType="xsd:double" dictRef="g:bondedValence" size="5">3.863 0.939 0.939 0.939 0.939</array>
          <array dataType="xsd:double" dictRef="g:freeValence"   size="5">0.0 0.0 0.0 0.0 0.0</array>
        </list>
      </property>
    </module>
  </comment>

  <comment class="example.output" id="bondOrder.ch2o2">
    <module cmlx:templateRef="bondOrder.valence" xmlns="http://www.xml-cml.org/schema" xmlns:cmlx="http://www.xml-cml.org/schema/cmlx">
      <property dictRef="g:bondOrderThreshold">
        <scalar dataType="xsd:double">0.05</scalar>
      </property>
      <property dictRef="g:bondorders">
        <list>
            <array dataType="xsd:integer" dictRef="g:atomId1"  size="5">1 1 1 2 3</array>
            <array dataType="xsd:integer" dictRef="g:atomId2"  size="5">2 3 4 3 5</array>
            <array dataType="xsd:double" dictRef="g:distance"  size="5">1.208 1.342 1.08 2.21 0.967</array>
            <array dataType="xsd:double" dictRef="g:bondOrder" size="5">1.948 0.988 0.877 0.071 0.777</array>
        </list>
      </property>
      <property dictRef="g:valences">
        <list>
          <array dataType="xsd:integer" dictRef="g:atomId"       size="5">1 2 3 4 5</array>
          <array dataType="xsd:string" dictRef="g:atomLabel"     size="5">C O O H H</array>
          <array dataType="xsd:double" dictRef="g:totalValence"  size="5">3.833 2.079 1.851 0.927 0.825</array>
          <array dataType="xsd:double" dictRef="g:bondedValence" size="5">3.833 2.079 1.851 0.927 0.825</array>
          <array dataType="xsd:double" dictRef="g:freeValence"   size="5">0.0 0.0 0.0 0.0 0.0</array>
        </list>
      </property>
    </module>
  </comment>

</template>
