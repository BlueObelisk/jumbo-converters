<template id="dipole.moment"
  repeat="*"
  name="ELECTROSTATIC MOMENTS"
  pattern="\s*-+\s*$\s*ELECTROSTATIC MOMENTS\s*$\s*-+\s*$"   offset="0"
  endPattern="\s*[\.]+ END OF PROPERTY EVALUATION [\.]+\s*"   endOffset="0" >

  <comment class="example.input" id="dipole.moment">
          ---------------------
          ELECTROSTATIC MOMENTS
          ---------------------

 POINT   1           X           Y           Z (BOHR)    CHARGE
                 0.000000    0.000000    0.000001        0.00 (A.U.)
         DX          DY          DZ         /D/  (DEBYE)
     0.000010    0.000010    0.000027    0.000031
  </comment>

  <record repeat="4"/>
  <record repeat="2" id="unparsed">{X,cmlx:unparsed}</record>
  <record repeat="1"/>
  <record id="dipole">\s+{F,cc:dipole}\s+{F,cc:dipole}\s+{F,cc:dipole}\s+{F,x:dipole}\s*</record>

  <transform process="createArray" xpath="."
                  from="./cml:list[@cmlx:templateRef='dipole']/cml:list/cml:scalar[@dictRef='cc:dipole']"/>

    <transform process="addUnits"
  xpath=".//cml:array[@dictRef='cc:dipole']"
  value="nonSi:debye"/>

  <transform process="addUnits"
  xpath=".//cml:scalar[@dictRef='x:dipole']"
  value="nonSi:debye"/>

  <transform process="createWrapperProperty"
                   xpath=".//*[@dictRef='cc:dipole']"/>

  <transform process="createWrapperProperty"
                   xpath=".//*[@dictRef='x:dipole']"/>

  <transform process="move"
                 to="."
                 xpath=".//*[contains(@dictRef,'cmlx:unparsed') or contains(@dictRef,'cc:dipole') or contains(@dictRef,'x:dipole')]" />

  <transform process="delete" xpath=".//cml:list[@cmlx:templateRef='missingID']"/>
  <transform process="delete" xpath=".//cml:list[@cmlx:templateRef='dipole']"/>

  <transform process="delete" xpath=".//cml:list[count(*)=0]"/>

  <comment class="example.output" id="dipole.moment">
	<module cmlx:templateRef="dipole.moment" xmlns="http://www.xml-cml.org/schema" xmlns:cmlx="http://www.xml-cml.org/schema/cmlx">
		<scalar dictRef="cmlx:unparsed">POINT   1           X           Y           Z (BOHR)    CHARGE</scalar>
		<scalar dictRef="cmlx:unparsed">0.000000    0.000000    0.000001        0.00 (A.U.)</scalar>
		<property dictRef="cc:dipole">
			<array dataType="xsd:double" size="3" units="nonSi:debye">1.0E-5 1.0E-5 2.7E-5</array>
		</property>
		<property dictRef="x:dipole">
			<scalar  dataType="xsd:double" units="nonSi:debye">3.1E-5</scalar>
		</property>
	</module>
  </comment>

</template>
