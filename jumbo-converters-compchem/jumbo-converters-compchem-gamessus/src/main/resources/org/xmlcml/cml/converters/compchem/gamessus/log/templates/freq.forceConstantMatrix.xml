<template id="force.constant.matrix"
  repeat="*"
  name="force.constant.matrix"
  pattern="\s*-+\s*$\s*CARTESIAN FORCE CONSTANT MATRIX\s*$\s*-+\s*" offset="0"
  endPattern="\s*-+\s*"                                          endOffset="0" >

  <comment class="example.input" id="force.constant.matrix">
          -------------------------------
          CARTESIAN FORCE CONSTANT MATRIX
          -------------------------------

                                   1                          2
                               C                          H         
                          X        Y        Z        X        Y        Z
  1   C            X 0.556796 0.000000 0.000000-0.047763 0.000000 0.000000
                   Y 0.000000 0.556795 0.000000 0.000000-0.230638-0.128932
                   Z 0.000000 0.000000 0.555093 0.000000-0.129037-0.138774
  2   H            X-0.047763 0.000000 0.000000 0.046570 0.000000 0.000000
                   Y 0.000000-0.230638-0.129037 0.000000 0.247696 0.142040
                   Z 0.000000-0.128932-0.138774 0.000000 0.142040 0.146939
  3   H            X-0.047763 0.000000 0.000000-0.001760 0.000000 0.000000
                   Y 0.000000-0.230638 0.129037 0.000000-0.020010 0.016623
                   Z 0.000000 0.128932-0.138774 0.000000-0.016623 0.013821
  4   H            X-0.230639 0.000000 0.129037 0.001477 0.000630-0.001810
                   Y 0.000000-0.047764 0.000000 0.024164 0.001478-0.014865
                   Z 0.128932 0.000000-0.138774 0.014865 0.001810-0.010993
  5   H            X-0.230639 0.000000-0.129037 0.001478-0.000630 0.001810
                   Y 0.000000-0.047764 0.000000-0.024164 0.001478-0.014865
                   Z-0.128932 0.000000-0.138774-0.014865 0.001810-0.010993

                                   3                          4
                               H                          H         
                          X        Y        Z        X        Y        Z
  3   H            X 0.046570 0.000000 0.000000 0.001477-0.024164 0.014865
                   Y 0.000000 0.247697-0.142040-0.000630 0.001478-0.001810
                   Z 0.000000-0.142040 0.146940-0.001810 0.014865-0.010993
  4   H            X 0.001477-0.000630-0.001810 0.247697 0.000000-0.142040
                   Y-0.024164 0.001478 0.014865 0.000000 0.046570 0.000000
                   Z 0.014865-0.001810-0.010993-0.142040 0.000000 0.146939
  5   H            X 0.001478 0.000630 0.001810-0.020009 0.000000-0.016623
                   Y 0.024164 0.001478 0.014865 0.000000-0.001760 0.000000
                   Z-0.014865-0.001810-0.010993 0.016623 0.000000 0.013821

                                   5
                               H         
                          X        Y        Z
  5   H            X 0.247697 0.000000 0.142040
                   Y 0.000000 0.046570 0.000000
                   Z 0.142040 0.000000 0.146940

  </comment>

  <!-- 
    This is a particulary difficult one!

    The above is a representation of the following part of a symmetric matrix:

                                   1                            2                           3                            4                           5
                               C                            H                           H                            H                           H         
                          X        Y        Z          X        Y        Z         X        Y        Z          X        Y        Z         X        Y        Z
  1   C            X 0.556796 0.000000 0.000000  -0.047763 0.000000 0.000000  
                   Y 0.000000 0.556795 0.000000   0.000000-0.230638-0.128932  
                   Z 0.000000 0.000000 0.555093   0.000000-0.129037-0.138774  

  2   H            X-0.047763 0.000000 0.000000   0.046570 0.000000 0.000000  
                   Y 0.000000-0.230638-0.129037   0.000000 0.247696 0.142040  
                   Z 0.000000-0.128932-0.138774   0.000000 0.142040 0.146939  

  3   H            X-0.047763 0.000000 0.000000  -0.001760 0.000000 0.000000   0.046570 0.000000 0.000000   0.001477-0.024164 0.014865 
                   Y 0.000000-0.230638 0.129037   0.000000-0.020010 0.016623   0.000000 0.247697-0.142040  -0.000630 0.001478-0.001810 
                   Z 0.000000 0.128932-0.138774   0.000000-0.016623 0.013821   0.000000-0.142040 0.146940  -0.001810 0.014865-0.010993 

  4   H            X-0.230639 0.000000 0.129037   0.001477 0.000630-0.001810   0.001477-0.000630-0.001810   0.247697 0.000000-0.142040 
                   Y 0.000000-0.047764 0.000000   0.024164 0.001478-0.014865  -0.024164 0.001478 0.014865   0.000000 0.046570 0.000000 
                   Z 0.128932 0.000000-0.138774   0.014865 0.001810-0.010993   0.014865-0.001810-0.010993  -0.142040 0.000000 0.146939 

  5   H            X-0.230639 0.000000-0.129037   0.001478-0.000630 0.001810   0.001478 0.000630 0.001810  -0.020009 0.000000-0.016623   0.247697 0.000000 0.142040
                   Y 0.000000-0.047764 0.000000  -0.024164 0.001478-0.014865   0.024164 0.001478 0.014865   0.000000-0.001760 0.000000   0.000000 0.046570 0.000000
                   Z-0.128932 0.000000-0.138774  -0.014865 0.001810-0.010993  -0.014865-0.001810-0.010993   0.016623 0.000000 0.013821   0.142040 0.000000 0.146940


    However it still contains redundant elements that need to be deleted to eventually retain these values:

                                   1                            2                           3                            4                           5
                               C                            H                           H                            H                           H         
                          X        Y        Z          X        Y        Z         X        Y        Z          X        Y        Z         X        Y        Z
  1   C            X 0.556796 
                   Y 0.000000 0.556795 
                   Z 0.000000 0.000000 0.555093

  2   H            X-0.047763 0.000000 0.000000   0.046570
                   Y 0.000000-0.230638-0.129037   0.000000 0.247696
                   Z 0.000000-0.128932-0.138774   0.000000 0.142040 0.146939  

  3   H            X-0.047763 0.000000 0.000000  -0.001760 0.000000 0.000000   0.046570
                   Y 0.000000-0.230638 0.129037   0.000000-0.020010 0.016623   0.000000 0.247697
                   Z 0.000000 0.128932-0.138774   0.000000-0.016623 0.013821   0.000000-0.142040 0.146940

  4   H            X-0.230639 0.000000 0.129037   0.001477 0.000630-0.001810   0.001477-0.000630-0.001810   0.247697
                   Y 0.000000-0.047764 0.000000   0.024164 0.001478-0.014865  -0.024164 0.001478 0.014865   0.000000 0.046570
                   Z 0.128932 0.000000-0.138774   0.014865 0.001810-0.010993   0.014865-0.001810-0.010993  -0.142040 0.000000 0.146939 

  5   H            X-0.230639 0.000000-0.129037   0.001478-0.000630 0.001810   0.001478 0.000630 0.001810  -0.020009 0.000000-0.016623   0.247697
                   Y 0.000000-0.047764 0.000000  -0.024164 0.001478-0.014865   0.024164 0.001478 0.014865   0.000000-0.001760 0.000000   0.000000 0.046570
                   Z-0.128932 0.000000-0.138774  -0.014865 0.001810-0.010993  -0.014865-0.001810-0.010993   0.016623 0.000000 0.013821   0.142040 0.000000 0.146940

  I believe the only way to achieve this, is to 
   - first collect all lines as they are,  
   - then create a new TRANSFORM-Action "reduce matrix" in Java to 
     - create a full 3N-by-3N Matrix (N number of atoms, for Methane: 15-by-15)
     - return only those values of the matrix, where i<=j
   - store those in an <array> element

  see: jumbo-converters_git/jumbo-converters-core/src/main/java/org/xmlcml/cml/converters/text/TransformElement.java

   Eventually that should leave us with 120 floating-point values:

 <array dataType="xsd:double" size="120">0.556796 0.0 0.556795 0.0 0.0 0.555093 -0.047763 0.0 0.0 0.04657 0.0 -0.230638 -0.129037 0.0 0.247696 0.0 -0.128932 -0.138774 0.0 0.14204 0.146939 -0.047763 0.0 0.0 -0.00176 0.0 0.0 0.04657 0.0 -0.230638 0.129037 0.0 -0.02001 0.016623 0.0 0.247697 0.0 0.128932 -0.138774 0.0 -0.016623 0.013821 0.0 -0.14204 0.14694 -0.230639 0.0 0.129037 0.001477 0.00063 -0.00181 0.001477 -0.00063 -0.00181 0.247697 0.0 -0.047764 0.0 0.024164 0.001478 -0.014865 -0.024164 0.001478 0.014865 0.0 0.04657 0.128932 0.0 -0.138774 0.014865 0.00181 -0.010993 0.014865 -0.00181 -0.010993 -0.14204 0.0 0.146939 -0.230639 0.0 -0.129037 0.001478 -0.00063 0.00181 0.001478 0.00063 0.00181 -0.020009 0.0 -0.016623 0.247697 0.0 -0.047764 0.0 -0.024164 0.001478 -0.014865 0.024164 0.001478 0.014865 0.0 -0.00176 0.0 0.0 0.04657 -0.128932 0.0 -0.138774 -0.014865 0.00181 -0.010993 -0.014865 -0.00181 -0.010993 0.016623 0.0 0.013821 0.14204 0.0 0.146940</array> 
   -->






  <comment class="example.output" id="force.constant.matrix">
    <module cmlx:templateRef="force.constant.matrix" xmlns="http://www.xml-cml.org/schema" xmlns:cmlx="http://www.xml-cml.org/schema/cmlx">
        <array dataType="xsd:double" dictRef="cc:forceConstants" size="120">0.556796 0.0 0.556795 0.0 0.0 0.555093 -0.047763 0.0 0.0 0.04657 0.0 -0.230638 -0.129037 0.0 0.247696 0.0 -0.128932 -0.138774 0.0 0.14204 0.146939 -0.047763 0.0 0.0 -0.00176 0.0 0.0 0.04657 0.0 -0.230638 0.129037 0.0 -0.02001 0.016623 0.0 0.247697 0.0 0.128932 -0.138774 0.0 -0.016623 0.013821 0.0 -0.14204 0.14694 -0.230639 0.0 0.129037 0.001477 0.00063 -0.00181 0.001477 -0.00063 -0.00181 0.247697 0.0 -0.047764 0.0 0.024164 0.001478 -0.014865 -0.024164 0.001478 0.014865 0.0 0.04657 0.128932 0.0 -0.138774 0.014865 0.00181 -0.010993 0.014865 -0.00181 -0.010993 -0.14204 0.0 0.146939 -0.230639 0.0 -0.129037 0.001478 -0.00063 0.00181 0.001478 0.00063 0.00181 -0.020009 0.0 -0.016623 0.247697 0.0 -0.047764 0.0 -0.024164 0.001478 -0.014865 0.024164 0.001478 0.014865 0.0 -0.00176 0.0 0.0 0.04657 -0.128932 0.0 -0.138774 -0.014865 0.00181 -0.010993 -0.014865 -0.00181 -0.010993 0.016623 0.0 0.013821 0.14204 0.0 0.14694</array>
    </module>
  </comment>

</template>
