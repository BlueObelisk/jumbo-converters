<transformList xmlns:xi="http://www.w3.org/2001/XInclude">

  <transform process="addNamespace" xpath="." name="convention" value="http://www.xml-cml.org/convention/" />
  <transform process="addAttribute" xpath="." name="convention" value="convention:compchem"/>
  <transform process="addNamespace" xpath="." value="http://www.xml-cml.org/dictionary/compchem/" name="cc"/>
  <transform process="addNamespace" xpath="." value="http://www.xml-cml.org/dictionary/compchem/" name="compchem"/>
  <transform process="addNamespace" xpath="." value="http://www.xml-cml.org/dictionary/compchem/gaussian" name="g"/>
  <transform process="addNamespace" xpath="." value="http://www.w3.org/2001/XMLSchema" name="xsd"/>
  
  <transform process="addNamespace" xpath="." value="http://www.xml-cml.org/unit/nonSi/" name="nonsi"/>
  <transform process="addNamespace" xpath="." value="http://www.xml-cml.org/dictionary/cml/" name="cml"/>

  <transform process="addChild" xpath="." elementName="cml:module" id="jobList1"  position="1"/>
  <transform process="addDictRef" xpath="./cml:module[@id='jobList1']" value="cc:jobList" />
  
  <transform process="addChild" xpath="./cml:module[@id='jobList1']" elementName="cml:module" id="job1"/>
  <transform process="addDictRef" xpath="./cml:module[@id='jobList1']/cml:module[@id='job1']" value="cc:job" />
    
  <!-- build environment module -->

  <transform process="addChild" xpath="//cml:module[@id='job1']" elementName="cml:module" id="environment"/>
  <transform process="addDictRef" xpath="//cml:module[@id='environment']" value="cc:environment"/>

  <transform process="addChild" xpath="//cml:module[@id='environment']" 
      elementName="cml:parameterList" position="0"/>

  <!-- move parameters to environment -->
  <transform process="addChild" xpath=".//cml:module[@id='environment']/cml:parameterList"
     elementName="cml:scalar" id="compchem.package"/>
  <transform process="addDictRef" xpath=".//cml:scalar[@id='compchem.package']"
     value="compchem:package"/>
  <transform process="setValue" xpath=".//cml:scalar[@dictRef='compchem:package']" value="NWChem"/>
  
  <transform process="move" xpath="./cml:module[@cmlx:templateRef='job']/*[starts-with(@dictRef,'compchem:')]" toXpath="//cml:module[@id='environment']/cml:parameterList"/>
  
  <transform process="move" xpath="//*[@dictRef='compchem:title'][1]" 
      toXpath="//cml:module[@id='environment']/cml:parameterList"/>
  <transform process="createWrapperParameter" xpath="//cml:module[@id='environment']/cml:parameterList/*" />
  <!--  tidy rest -->
  <transform process="delete" xpath=".//cml:module[@cmlx:templateRef='acknow']"/>
  <transform process="addChild" xpath=".//cml:module[@id='environment']"
     elementName="cml:module" id="environment.userDefined" dictRef="cc:userDefinedModule"/>
  <transform process="move" xpath=".//cml:module[
       @cmlx:templateRef='argument' 
    or @cmlx:templateRef='dirinfo'
    or @cmlx:templateRef='integralfile'
    or @cmlx:templateRef='job'
    or @cmlx:templateRef='library file'
    or @cmlx:templateRef='nccp' 
    or @cmlx:templateRef='scaling'
    ]" 
     toXpath="//cml:module[@id='environment.userDefined']"/>
     

<!-- ================ initialization ================================= -->

  <transform process="addChild" xpath="//cml:module[@id='job1']" elementName="cml:module" id="initialization"/>
  <transform process="addDictRef" xpath="//cml:module[@id='initialization']" value="cc:initialization"/>
  
  <transform process="addChild" xpath="//cml:module[@id='initialization']" elementName="cml:parameterList" />
  
  <!-- move modules to initialization -->
  
  <transform process="move" 
    xpath=".//cml:module[@cmlx:templateRef='geninfo']/cml:scalar[starts-with(@dictRef,'cc:')]" 
    toXpath=".//cml:module[@id='initialization']/cml:parameterList"/> 
  <transform process="createWrapperParameter" 
     xpath="//cml:module[@id='initialization']/cml:parameterList/*" />

  <!--  and molecule -->  
    <transform process="move" xpath=".//cml:molecule[@id='molgeom']" 
        toXpath=".//cml:module[@id='initialization']"/> 

  <!--  tidy rest -->
  <transform process="delete" xpath=".//cml:module[@cmlx:templateRef='foobar']"/>
  <transform process="addChild" xpath=".//cml:module[@id='initialization']"
     elementName="cml:module" id="initialization.userDefined" dictRef="cc:userDefinedModule"/>
  <transform process="move" xpath=".//cml:module[
       @cmlx:templateRef='atmass' 
    or @cmlx:templateRef='basis' 
    or @cmlx:templateRef='converge' 
    or @cmlx:templateRef='effnucrep' 
    or @cmlx:templateRef='gridinfo' 
    or @cmlx:templateRef='gridpts' 
    or @cmlx:templateRef='memoryUtil' 
    or @cmlx:templateRef='nonvaritener' 
    or @cmlx:templateRef='nucdipole' 
    or @cmlx:templateRef='quartets' 
    or @cmlx:templateRef='recordsize' 
    or @cmlx:templateRef='screentol' 
    or @cmlx:templateRef='superposatomguess' 
    or @cmlx:templateRef='xcinfo' 
    ]" 
     toXpath="//cml:module[@id='initialization.userDefined']"/>

<!-- ================ calculation ================================= -->

  <transform process="addChild" xpath="//cml:module[@id='job1']" elementName="cml:module" id="calculation"/>
  <transform process="addDictRef" xpath="//cml:module[@id='calculation']" value="cc:calculation"/>
  
  <transform process="addChild" xpath="//cml:module[@id='calculation']" elementName="cml:propertyList" />
  
  <!-- move modules to calculation -->
  
  <transform process="createWrapperProperty" 
     xpath="//cml:module[@id='calculation']/cml:propertyList/*" />

  <!--  and molecule -->  
  <!-- 
    <transform process="move" xpath=".//cml:molecule[@id='molgeom']" 
        toXpath=".//cml:module[@id='initialization']"/> 
  -->
  
  <!--  tidy rest -->
  <transform process="delete" xpath=".//cml:module[@cmlx:templateRef='foobar']"/>
  <transform process="addChild" xpath=".//cml:module[@id='calculation']"
     elementName="cml:module" id="calculation.userDefined" dictRef="cc:userDefinedModule"/>
  <transform process="move" xpath=".//cml:module[
       @cmlx:templateRef='convergenceiter' 
    or @cmlx:templateRef='nonvarinitener' 
    ]" 
     toXpath="//cml:module[@id='calculation.userDefined']"/>


<!-- ================ finalization ================================= -->


  <transform process="addChild" xpath="//cml:module[@id='job1']" elementName="cml:module" id="finalization"/>
  <transform process="addDictRef" xpath="//cml:module[@id='finalization']" value="cc:finalization"/>
  
  <transform process="addChild" xpath="//cml:module[@id='finalization']" elementName="cml:propertyList" />
  
  <!-- move modules to finalization -->
  
  <transform process="createWrapperProperty" 
     xpath="//cml:module[@id='finalization']/cml:propertyList/*" />

  <!--  and molecule -->  
    <transform process="copy" xpath=".//cml:molecule[@id='molgeom']" 
        toXpath="//cml:module[@id='finalization']" id="molgeom.copy"/> 
  
  <!--  tidy rest -->
  <transform process="delete" xpath=".//cml:module[@cmlx:templateRef='foobar']"/>
  <transform process="addChild" xpath=".//cml:module[@id='finalization']"
     elementName="cml:module" id="finalization.userDefined" dictRef="cc:userDefinedModule"/>
  <transform process="addChild" xpath="//cml:module[@id='finalization.userDefined']" 
     elementName="cml:module" id="eigenvector.list" dictRef="cc:eigenvector.list"/>
  <transform process="move" xpath=".//cml:module[@cmlx:templateRef='vector']" 
     toXpath="//cml:module[@id='eigenvector.list']"/>
     <!--  fukui -->
  <transform process="addChild" xpath="//cml:module[@id='finalization.userDefined']" 
     elementName="cml:module" id="fukui.list" dictRef="cc:fukui.list"/>
  <transform process="move" xpath=".//cml:module[@cmlx:templateRef='fukuilite']" 
     toXpath="//cml:module[@id='fukui.list']"/>
  <transform process="pullup" xpath=".//cml:module[@cmlx:templateRef='fukuilite']/cml:list"/>
  <transform process="delete" xpath=".//cml:module[@cmlx:templateRef='fukuilite']"/>
  <transform process="addDictRef" xpath=".//cml:module[@dictRef='cc:fukui.list']/cml:list[1]" value="cc:fukui.nnplus"/>
  <transform process="addDictRef" xpath=".//cml:module[@dictRef='cc:fukui.list']/cml:list[2]" value="cc:fukui.nnminus"/>
  <transform process="addDictRef" xpath=".//cml:module[@dictRef='cc:fukui.list']/cml:list[3]" value="cc:fukui.snplus"/>
  <transform process="addDictRef" xpath=".//cml:module[@dictRef='cc:fukui.list']/cml:list[4]" value="cc:fukui.ssplus"/>
  <transform process="addDictRef" xpath=".//cml:module[@dictRef='cc:fukui.list']/cml:list[5]" value="cc:fukui.nsplus"/>
  <transform process="addDictRef" xpath=".//cml:module[@dictRef='cc:fukui.list']/cml:list[6]" value="cc:fukui.ssminus"/>
  <transform process="addDictRef" xpath=".//cml:module[@dictRef='cc:fukui.list']/cml:list[7]" value="cc:fukui.nsminus"/>
  
  <transform process="addDictRef" xpath=".//cml:list[@dictRef='cc:fukui.nnplus']/cml:array[@dictRef='g:fukui']"
    value="cc:fukui.nnplus"/>
  <transform process="split" xpath=".//cml:list[@dictRef='cc:fukui.nnplus']/cml:array[@dictRef='cc:fukui.nnplus']"/>
  <transform process="copy" xpath=".//cml:list[@dictRef='cc:fukui.nnplus']/cml:list/cml:scalar"
   toXpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom" />
  <transform process="createWrapperProperty" 
      xpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom/cml:scalar[@dictRef='cc:fukui.nnplus']" />
  
  <transform process="addDictRef" xpath=".//cml:list[@dictRef='cc:fukui.nnminus']/cml:array[@dictRef='g:fukui']"
    value="cc:fukui.nnminus"/>
  <transform process="split" xpath=".//cml:list[@dictRef='cc:fukui.nnminus']/cml:array[@dictRef='cc:fukui.nnminus']"/>
  <transform process="copy" xpath=".//cml:list[@dictRef='cc:fukui.nnminus']/cml:list/cml:scalar"
   toXpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom" />
  <transform process="createWrapperProperty" 
      xpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom/cml:scalar[@dictRef='cc:fukui.nnminus']" />
  
  <transform process="addDictRef" xpath=".//cml:list[@dictRef='cc:fukui.snplus']/cml:array[@dictRef='g:fukui']"
    value="cc:fukui.snplus"/>
  <transform process="split" xpath=".//cml:list[@dictRef='cc:fukui.snplus']/cml:array[@dictRef='cc:fukui.snplus']"/>
  <transform process="copy" xpath=".//cml:list[@dictRef='cc:fukui.snplus']/cml:list/cml:scalar"
   toXpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom" />
  <transform process="createWrapperProperty" 
      xpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom/cml:scalar[@dictRef='cc:fukui.snplus']" />
  
  <transform process="addDictRef" xpath=".//cml:list[@dictRef='cc:fukui.ssplus']/cml:array[@dictRef='g:fukui']"
    value="cc:fukui.ssplus"/>
  <transform process="split" xpath=".//cml:list[@dictRef='cc:fukui.ssplus']/cml:array[@dictRef='cc:fukui.ssplus']"/>
  <transform process="copy" xpath=".//cml:list[@dictRef='cc:fukui.ssplus']/cml:list/cml:scalar"
   toXpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom" />
  <transform process="createWrapperProperty" 
      xpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom/cml:scalar[@dictRef='cc:fukui.ssplus']" />
  
  <transform process="addDictRef" xpath=".//cml:list[@dictRef='cc:fukui.nsplus']/cml:array[@dictRef='g:fukui']"
    value="cc:fukui.nsplus"/>
  <transform process="split" xpath=".//cml:list[@dictRef='cc:fukui.nsplus']/cml:array[@dictRef='cc:fukui.nsplus']"/>
  <transform process="copy" xpath=".//cml:list[@dictRef='cc:fukui.nsplus']/cml:list/cml:scalar"
   toXpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom" />
  <transform process="createWrapperProperty" 
      xpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom/cml:scalar[@dictRef='cc:fukui.nsplus']" />
  
  <transform process="addDictRef" xpath=".//cml:list[@dictRef='cc:fukui.ssminus']/cml:array[@dictRef='g:fukui']"
    value="cc:fukui.ssminus"/>
  <transform process="split" xpath=".//cml:list[@dictRef='cc:fukui.ssminus']/cml:array[@dictRef='cc:fukui.ssminus']"/>
  <transform process="copy" xpath=".//cml:list[@dictRef='cc:fukui.ssminus']/cml:list/cml:scalar"
   toXpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom" />
  <transform process="createWrapperProperty" 
      xpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom/cml:scalar[@dictRef='cc:fukui.ssminus']" />
  
  <transform process="addDictRef" xpath=".//cml:list[@dictRef='cc:fukui.nsminus']/cml:array[@dictRef='g:fukui']"
    value="cc:fukui.nsminus"/>
  <transform process="split" xpath=".//cml:list[@dictRef='cc:fukui.nsminus']/cml:array[@dictRef='cc:fukui.nsminus']"/>
  <transform process="copy" xpath=".//cml:list[@dictRef='cc:fukui.nsminus']/cml:list/cml:scalar"
   toXpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom" />
  <transform process="createWrapperProperty" 
      xpath="//cml:molecule[@id='molgeom.copy']/cml:atomArray/cml:atom/cml:scalar[@dictRef='cc:fukui.nsminus']" />
  
  <transform process="move" xpath=".//cml:module[
       @cmlx:templateRef='centermass' 
    or @cmlx:templateRef='gastats' 
    or @cmlx:templateRef='globarrays' 
    or @cmlx:templateRef='parallel' 
    or @cmlx:templateRef='shell' 
    or @cmlx:templateRef='multipole' 
    or @cmlx:templateRef='totaldft' 
    ]" 
     toXpath="//cml:module[@id='finalization.userDefined']"/>


 <!-- ============================= clean up output =========================== -->
 
    <transform process="delete" xpath="//cml:module[
         @cmlx:templateRef='auth'
      or @cmlx:templateRef='citation'
      or @cmlx:templateRef='nwcheminpmod'
      ]" />
    
    <transform process="delete" xpath="//cml:atom/cml:scalar[@dictRef='cc:atomtypeRef']" />
    <transform process="delete" xpath="//cml:atom/cml:scalar[@dictRef='compchem:atomicNumber']" />
    
    <transform process="delete" xpath=".//@cmlx:templateRef" />
    <transform process="delete" xpath=".//@cmlx:lineCount" />

<!--     
    <transform process="delete" xpath="/cml:module/cml:scalar" />
-->    
</transformList>    
 