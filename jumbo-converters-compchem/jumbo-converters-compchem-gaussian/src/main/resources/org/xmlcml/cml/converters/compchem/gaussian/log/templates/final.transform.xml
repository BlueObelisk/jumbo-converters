<transformList>

<!--  ====================== FINALIZATION ===================== -->
    
  <!-- build finalization module -->
  
  <transform process="addChild" xpath="//cml:module[@id='job']" elementName="cml:module" id="finalization"/>
  <transform process="addDictRef" xpath="//cml:module[@id='finalization']" value="cc:finalization"/>
  
  <transform process="addChild" xpath="//cml:module[@id='finalization']" elementName="cml:propertyList" />

  <!-- move modules to finalization -->
  
  <transform process="moveRelative" xpath=".//cml:module[@cmlx:templateRef='l601.popanal'][last()]" 
    toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']"/> 
  <transform process="moveRelative" xpath=".//cml:module[@cmlx:templateRef='l9999.final'][1]" 
    toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']"/> 
  <transform process="moveRelative" xpath=".//cml:module[@cmlx:templateRef='l9999.archive'][1]" 
    toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']"/> 
  
  <transform process="addDictRef" xpath=".//cml:module[@id='finalization']/cml:module" value="cc:userDefinedModule" />

  <!-- move properties to finalization -->
  
  <transform process="moveRelative" xpath=".//cml:module[@cmlx:templateRef='l9999.archive']/cml:scalar[@dictRef='cc:electronicstate']" 
      toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']/cml:propertyList" />
      
    <!--  some energy names are composite (e.g. rohfenergy) -->
  <transform process="moveRelative" xpath=".//cml:module[@cmlx:templateRef='l9999.archive']/cml:scalar[starts-with(@dictRef,'cc:') and contains(@dictRef,'energy')][last()]" 
      toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']/cml:propertyList"/> 
  <transform process="moveRelative" xpath=".//cml:module[@cmlx:templateRef='l9999.archive']/cml:scalar[@dictRef='cc:rmsd'][last()]" 
      toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']/cml:propertyList"/> 
  <transform process="moveRelative" xpath=".//cml:module[@cmlx:templateRef='l9999.archive']/cml:scalar[@dictRef='cc:rmsf'][last()]" 
      toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']/cml:propertyList"/> 
  <transform process="moveRelative" xpath=".//cml:module[@cmlx:templateRef='l9999.archive']/cml:array[@dictRef='cc:dipole'][last()]" 
      toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']/cml:propertyList"/> 

  
  <transform process="addChild" xpath="//cml:module[@id='finalization']" elementName="cml:module" id="otherComponents"/>
  <transform process="addDictRef" xpath=".//cml:module[@id='finalization']/cml:module[@id='otherComponents']" value="cc:userDefinedModule" />
  
  <transform process="moveRelative" xpath="//cml:module[@id='finalization']/cml:module[not(@id='otherComponents')]" 
       toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']/cml:module[@id='otherComponents']"/>
  <transform process="moveRelative" xpath="//cml:module[@id='finalization']//cml:molecule[1]" 
       toXpath="./ancestor::*[@dictRef='cc:job']/cml:module[@id='finalization']"/>
  

 <!-- wrap all properties -->
  <transform process="createWrapperProperty" xpath="//cml:module[@id='finalization']/cml:propertyList/*" />  

  
</transformList> 