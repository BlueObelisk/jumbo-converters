<transformList
  xmlns:xi="http://www.w3.org/2001/XInclude"
  >

  <xi:include href="namespaces.transform.xml"/>

  <transform process="addChild" xpath="." elementName="cml:module" id="jobList1" dictRef="cc:jobList"/>

  <transform process="addDictRef" xpath="./cml:module[@cmlx:templateRef='job']" value="cc:job" />
  <transform process="addAttribute" xpath="./cml:module[@cmlx:templateRef='job']" name="id" value="job" />
  <transform process="move" xpath=".//cml:module[@dictRef='cc:job']" toXpath=".//cml:module[@dictRef='cc:jobList']" />

<!-- 
  <transform process="debugNodes" xpath="."/>
 -->  
  
  <xi:include href="environment.transform.xml"/>
  <xi:include href="initial.transform.xml"/>
  <xi:include href="calculation.transform.xml"/>
  <xi:include href="final.transform.xml"/>


  <!-- move remaining modules to calculation -->
  
  <transform process="move" xpath="/cml:module/cml:module[not(@id='jobList1')]" toXpath="//cml:module[@id='calculation']"/> 

<!--  group calculation modules --> 

  <transform process="addSibling" xpath="./cml:module[@id='calculation']/cml:module[@cmlx:templateRef='l202.rotconst']" 
      elementName="cml:module" id="l202.group" position="1"/> 
  <transform process="groupSiblings" xpath=".//cml:module[@id='l202.group']" /> 
  <transform process="move" xpath=".//cml:module[@id='l202.group']" toXpath="/cml:module/cml:module[@id='calculation']"/> 

  <transform process="addDictRef" xpath=".//cml:module[@id='calculation']/cml:module" value="cc:userDefinedModule" />

  <transform process="addAttribute" xpath=".//cml:molecule" name="formalCharge" 
    value="number(//cml:scalar[@dictRef='formalCharge'][1])" />
  <transform process="addAttribute" xpath=".//cml:molecule" name="spinMultiplicity" 
    value="number(//cml:scalar[@dictRef='spinMultiplicity'][1])" />
    
  <xi:include href="clean.transform.xml"/>

</transformList>    
 